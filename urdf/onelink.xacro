<?xml version="1.0" ?>
<robot name="onelink" xmlns:xacro="http://www.ros.org/wiki/xacro">

  <xacro:include filename="$(find onelink_description)/urdf/materials.xacro" />
  <xacro:include filename="$(find onelink_description)/urdf/onelink.gazebo" />
  
  <link name="world"/>

  <link name="base_link">
    <inertial>
      <origin xyz="0.0 0.0 0.0" rpy="0 0 0"/>
      <mass value="280.85"/>
      <inertia ixx="0.01" iyy="0.01" izz="0.01" ixy="0.0" iyz="0.0" ixz="0.0"/>
    </inertial>
    <visual>
      <origin xyz="0.0 0.0 0.0" rpy="0 0 0"/>
      <geometry>
        <mesh filename="file://$(find onelink_description)/meshes/base_link.stl" scale="0.001 0.001 0.001"/>
      </geometry>
      <material name="silver"/>
    </visual>
    <collision>
      <origin xyz="0.0 0.0 0.0" rpy="0 0 0"/>
      <geometry>
        <mesh filename="file://$(find onelink_description)/meshes/base_link.stl" scale="0.001 0.001 0.001"/>
      </geometry>
    </collision>
  </link>

  <joint name="slider_joint" type="prismatic">
    <origin xyz="0.0 0.0 0.0" rpy="0 0 0"/>
    <parent link="world"/>
    <child link="base_link"/>
    <axis xyz="1 0 0"/>
    <dynamics damping="0.0" friction="1377.0"/>
    <limit lower="-10000.0" upper="10000.0" effort="1000000.0" velocity="1000000.0"/>
    <!-- 소프트 리밋(컨트롤 계층): 실험②에서 on/off 비교용 -->
    <!-- <safety_controller k_position="5000.0" k_velocity="5000.0"
                      soft_lower_limit="-2.9" soft_upper_limit="2.9"/> -->
  </joint>

  <ros2_control name="gazebo_system" type="system">
    <hardware>
      <plugin>gazebo_ros2_control/GazeboSystem</plugin>
    </hardware>

    <joint name="slider_joint">
      <command_interface name="effort"/>
      <state_interface   name="position"/>
      <state_interface   name="velocity"/>
      <state_interface   name="effort"/>
    </joint>
  </ros2_control>

  <!-- Gazebo Classic + ros2_control 플러그인 -->
  <gazebo>
    <plugin name="gazebo_ros2_control" filename="libgazebo_ros2_control.so">
      <parameters>$(find onelink_description)/config/controller_manager.yaml</parameters>
    </plugin>
    <plugin name="ft_sensor_slider" filename="libgazebo_ros_ft_sensor.so">
      <ros>
        <namespace>slider_joint</namespace>
        <remapping>wrench:=wrench</remapping>
      </ros>
      <frame_name>base_link</frame_name>
      <joint_name>slider_joint</joint_name>
      <update_rate>1000</update_rate>
    </plugin>
  </gazebo>

</robot>
